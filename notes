TODO: fix the state lifecycle, it is fucking up somehow... try and reduce then nummber of updates